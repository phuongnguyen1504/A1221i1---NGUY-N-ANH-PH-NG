<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{text}">

<head>
    <meta charset="UTF-8">
    <title>CustomerList</title>

</head>
<body>
<div layout:fragment="content-page">
    <div class="container">
        <div class="row mb-3">
            <div class="col-lg-6 table-title">
                <a href="#addEditModal" class="btn btn-success add" data-bs-toggle="modal"><i
                        class='bx bx-plus-circle'></i><span>Add New Customer</span></a>
            </div>
<!--            <div class="col-lg-6 table-search" th:with="tmp=${#strings.arraySplit(q,':')}">-->
<!--                <form class="row gy-2 gx-3 align-items-center">-->
<!--                    <div class="col-auto">-->
<!--                        <select class="form-select" id="searchBy">-->
<!--                            <option th:selected="${tmp.length}>0 ?${tmp[0]}=='all':false" value="all">All search By ...-->
<!--                            </option>-->
<!--                            <option th:selected="${tmp.length}>0 ?${tmp[0]}=='name':false" value="name">Name</option>-->
<!--                            <option th:selected="${tmp.length}>0 ?${tmp[0]}=='birthday':false" value="birthday">-->
<!--                                Birthday-->
<!--                            </option>-->
<!--                            <option th:selected="${tmp.length}>0 ?${tmp[0]}=='gender':false" value="gender">Gender-->
<!--                            </option>-->
<!--                            <option th:selected="${tmp.length}>0 ?${tmp[0]}=='idcard':false" value="id_card">Id_card-->
<!--                            </option>-->
<!--                            <option th:selected="${tmp.length}>0 ?${tmp[0]}=='phone':false" value="phone">phone</option>-->
<!--                            <option th:selected="${tmp.length}>0 ?${tmp[0]}=='mail':false" value="mail">Mail</option>-->
<!--                            <option th:selected="${tmp.length}>0 ?${tmp[0]}=='address':false" value="address">Address-->
<!--                            </option>-->
<!--                        </select>-->
<!--                    </div>-->
<!--                    <div class="col-auto">-->
<!--                        <input type="text" class="form-control" id="searchVal"-->
<!--                               th:value="${tmp.length}>0 ? ${tmp[1]}:''">-->
<!--                    </div>-->
<!--                    <div class="col-auto">-->
<!--                        <a id="sbmSearch" href="/" class="btn btn-secondary">Submit</a>-->
<!--                    </div>-->
<!--                </form>-->
<!--            </div>-->
        </div>
        <div class="row" >
            <table class="table table-striped table-hover">
                <thead style="background: #ece1be"
                       >
                <tr>
                    <th scope="col">
                            <div class="pt-1" style="float: left">Contract Code</div>
                    </th>
                    <th scope="col">
                            <div class="pt-1" style="float: left">Room Code</div>

                    </th>
                    <th scope="col">
                            <div class="pt-1" style="float: left">Name</div>

                    </th>

                    <th scope="col">

                            <div class="pt-1" style="float: left">Date Contract</div>

                    </th>
                    <th scope="col">
                            <div class="pt-1" style="float: left">Time Rent</div>

                    </th>
                    <th scope="col">

                            <div class="pt-1" style="float: left">Total</div>

                    </th>
                    <th scope="col">Actions</th>
                </tr>
                </thead>
                <tbody class="body_table">
                <tr th:each="c,i:${res}" >
<!--                    <td th:text="${i.count+res.getNumber()*res.getSize()}"></td>-->
                    <td th:text="${c.contractcode}"></td>
                    <td th:text="${c.room.roomcode}"></td>
                    <td th:text="${c.name}"></td>
                    <td th:text="${c.dateContract}"></td>
                    <td th:text="${c.timeRent}"></td>
                    <td th:text="${c.money}"></td>
<!--                    <div th:switch="${c.gender}">-->
<!--                        <td th:case="0">Nam</td>-->
<!--                        <td th:case="1">Nu</td>-->
<!--                        <td th:case="2">LGBT</td>-->
<!--                    </div>-->
                    <td>
                        <a data-bs-target="#addEditModal" href="" class="edit" data-bs-toggle="modal"
                           th:data-id="${c.contractcode}"
                           th:data-name="${c.name}"
                           th:data-date="${c?.dateContract}" th:data-rent="${c?.timeRent}"
                           th:data-money="${c?.money}"
                           th:data-room="${c?.room.roomcode}">
                            <i class="bx bxs-edit-alt" data-bs-toggle="tooltip" title="Edit"></i>
                        </a>
                        <a data-bs-target="#deleteModal" href="" class="delete" data-bs-toggle="modal"
                           th:data-id="${c.contractcode}"
                           th:data-name="${c.name}">
                            <i class="bx bxs-message-alt-x" data-bs-toggle="tooltip" title="Delete"></i>


                        </a>
                    </td>
                </tr>
                </tbody>
            </table>

    <div class="page-footer">
        <a href="#" class="page-footer-item page-footer-item-right">Category<i data-feather="arrow-right"
                                                                               class="footer-right"></i></a>
    </div>


    <div th:replace="~{addEdit :: addEditModal()}"></div>
    <div th:replace="~{delete :: deleteModal()}"></div>
    <script th:inline="javascript">
        $(function () {
            if ([[${isError}]]) {
                $("#addEditModal").modal('show');
            }

            if ([[${msg}]]) {
                iziToast.success({position: "topRight", message: [[${msg}]]});
            };
            $(".date.form-control").datepicker();
            $(".date.form-control").on("change",function (){
                let value=$(this).val().split("/");
                console.log(value);
                $(".date.form-control").val(value[1]+"/"+value[0]+"/"+value[2]);
            });
            //Add modal
            $(".add").click(function () {
                $(".modal-title").text("Add Product");
                $('.error').hide();
                $('.contractcode').show();
                resetForm();

            });
            //resetForm
            function resetForm() {
                $(".contractcode").val("");
                $("input[name='name'],input[name='birthday'],input[name='gender'],input[name='idcard'],input[name='phone'],input[name='mail'],input[name='address'],input[name='category']").val("");
                $("#lbErrorName").hide();
                $("#lbErrorStartPrice").hide();
            };
            //edit modal
            $('.edit').bind("click",function () {
                let beforeid = $('input.contractcode').val();
                let id = $(this).data("id");
                if (beforeid != id) {
                    $('.error').hide();
                }
                console.log(id);
                ediObject(id);
            });
                function ediObject(id){
                $.ajax({
                    url:`/customer/edit/`+id,
                    method:`GET`,
                    dataType:"JSON",
                    success:function (data){
                        console.log(data);
                        console.log(data.customerType.roomcode);

                        $("#addEditModal").modal('show');
                        $(".modal-title").text("Edit Product");
                        $('.form_customer').attr("object",data);
                        $('.contractcode').val(data.contractcode).hide();
                        $('.customer_name').val(data.name);
                        $('.customer_birthday').val(data.birthday);
                        $('#gender').val(data.gender);
                        $('.customer_card').val(data.idcard);
                        $('.customer_phone').val(data.phone);
                        $('.customer_mail').val(data.mail);
                        $('.customer_address').val(data.address);
                        $('.category-selection select').val(data.room.roomcode).change();

                    },
                    error:function (){
                        alert("Khong ton tai");

                    }
                })
            };
            //Delete modal
              //hoáº·c $('.addToCartButton').unbind('click').click(function()
              //https://stackoverflow.com/questions/56537007/onclick-ajax-delete-confirmation-modal-causing-previous-request-ajax-also-proces
            $('.delete').click(function () {
                let id = $(this).data("id");
                console.log("ID:" + id);
                $('#deleteval').val(id);
                console.log(id);
                $('.delete_form').attr("action", "/contract/delete?id=" + id);
            });
           //search button
            $("#sbmSearch").click(function () {
                if ($("#searchVal").val() != '') {
                    const q = $("#searchBy").val() + ":" + $("#searchVal").val();
                    $("#sbmSearch").attr('href', '?q=' + q);
                }
                else {
                    $("#sbmSearch").attr('href', '/customer');

                }
            });
        });
    </script>
<!--        // alert("host = "-->
<!--        //     + $(location).attr('host')-->
<!--        //     + "\nhostname = "-->
<!--        //     + $(location).attr('hostname')-->
<!--        //     + "\npathname = "-->
<!--        //     + $(location).attr('pathname')-->
<!--        //     + "\nhref = "-->
<!--        //     + $(location).attr('href')-->
<!--        //     + "\nport = " + $(location).attr('port')-->
<!--        //     + "\nprotocol = "-->
<!--        //     + $(location).attr('protocol'));-->

</div>
</body>
</html>


